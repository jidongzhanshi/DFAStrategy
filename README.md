# DFA动态定投策略

## 策略概述

DFA（Dynamic Fund Averaging）动态定投策略是一种基于技术指标的智能定投策略。该策略通过分析价格与移动平均线的偏离度来动态调整每期投资金额，并在达到目标收益率时自动减仓锁定利润。

## 策略特点

### 🎯 核心特性
- **动态投资**：根据价格偏离度调整投资金额
- **自动止盈**：达到75%收益率时自动减仓50%
- **冷却机制**：避免频繁交易，设置30天减仓冷却期
- **精确计算**：支持小数份额，精确计算成本和收益

### 📊 投资逻辑
- **基础定投**：每14天投资一次，基础金额70美元
- **偏离度调整**：价格低于MA120时加大投资，高于时减少投资
- **风险控制**：价格极度高估时暂停投资

## 策略参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| base_cash | 70 | 每期基础投资金额（美元） |
| ma_period | 120 | 移动平均线周期 |
| investment_interval | 14 | 投资间隔天数 |
| target_return | 75 | 目标收益率（%） |
| sell_ratio | 0.5 | 减仓比例 |
| profit_taking_cooldown | 30 | 减仓冷却天数 |

## 投资乘数规则

| 偏离度范围 | 投资乘数 | 市场状态 |
|------------|----------|----------|
| ≤ -20% | 2.2 | 极度低估 |
| -20% ~ -10% | 1.8 | 显著低估 |
| -10% ~ 0% | 1.4 | 正常偏低 |
| 0% ~ 5% | 1.0 | 正常估值 |
| 5% ~ 15% | 0.5 | 正常偏高 |
| 15% ~ 25% | 0.2 | 显著高估 |
| > 25% | 0.0 | 极度高估 |

## 文件结构

```
dfa_strategy/
├── dfa_strategy.py      # 主要策略代码
├── README.md           # 说明文档
└── requirements.txt    # 依赖包
```

## 安装依赖

```bash
pip install backtrader pandas ccxt
```

## 使用方法

### 基本使用
```python
# 运行SOLUSDT回测
python dfa_strategy.py

# 运行其他币种回测
run_dfa_binance_backtest(symbol='BTCUSDT', data_limit=1000)
run_dfa_binance_backtest(symbol='ETHUSDT', data_limit=1000)
```

### 自定义参数
```python
# 在DFAStrategy的params中修改
params = (
    ('base_cash', 100),      # 修改基础投资金额
    ('investment_interval', 7),  # 修改为每周定投
    ('target_return', 50),   # 修改目标收益率
    # ... 其他参数
)
```

## 输出报告

策略运行后会生成详细的回测报告：

### 📊 财务概览
- 实际总投资金额
- 当前持仓成本和价值
- 已实现利润和总卖出金额
- 基于投资的总回报率和年化回报率

### 📈 投资历史
- 平均偏离度和投资乘数
- 总投资金额统计
- 最大最小单次投资

### 🎯 减仓记录
- 每次减仓的详细记录
- 减仓统计和利润/投资比

## 策略优势

### ✅ 资金效率高
- 只在低估时加大投资
- 高估时减少或暂停投资
- 自动止盈锁定利润

### ✅ 风险控制
- 避免追涨杀跌
- 冷却机制防止过度交易
- 基于实际投资成本计算收益

### ✅ 适应性强
- 适用于各种加密货币
- 参数可灵活调整
- 支持不同市场环境

## 性能指标

策略会计算以下关键指标：
- **总回报率**：基于实际投资成本的回报
- **年化回报率**：年化后的投资回报
- **利润/投资比**：已实现利润占总投资的比例
- **减仓次数**：策略执行减仓的次数

## 注意事项

1. **数据来源**：策略使用币安API获取数据，需要稳定的网络连接
2. **代理设置**：代码中包含代理设置，根据实际网络环境调整
3. **回测限制**：历史数据可能不包含所有市场情况，实际表现可能有所不同
4. **风险提示**：加密货币投资具有高风险，请在充分了解风险后使用

## 自定义建议

### 🎨 参数优化
- 根据不同币种的波动性调整`target_return`
- 根据投资频率调整`investment_interval`
- 根据风险偏好调整投资乘数规则

### 🔧 功能扩展
- 添加止损机制
- 支持多币种同时投资
- 添加邮件/短信通知功能

## 版本历史

- v1.0：基础DFA策略实现
- v1.1：添加减仓冷却机制
- v1.2：优化份额计算和财务报告

## 技术支持

如有问题或建议，请提交Issue或联系开发团队。

---

**免责声明**：本策略仅供学习和研究使用，不构成投资建议。使用者应自行承担投资风险。
